<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.bubble.user.relation.dao.UserRelationDao" >
    <sql id="columns">
      `id`,
      `follower_id`,
      `follower_nick_name`,
      `follower_self_signature`,
      `follower_avatar_url`,
      `user_id`,
      `user_nick_name`,
      `user_self_signature`,
      `user_avatar_url`
    </sql>
  
  <resultMap id="userRelation" type="userRelationEntity">
    <result column="id" property="id"/>
    <result column="follower_id" property="followerId"/>
    <result column="follower_nick_name" property="followerNickname"/>
    <result column="follower_self_signature" property="followerSelfSignature"/>
    <result column="follower_avatar_url" property="followerAvatarUrl"/>
    <result column="user_id" property="userId"/>
    <result column="user_nick_name" property="userNickname"/>
    <result column="user_self_signature" property="userSelfSignature"/>
    <result column="user_avatar_url" property="userAvatarUrl"/>
  </resultMap>

  <insert id="createRelation">
    INSERT INTO
    <trim prefix=" `user_relation` (" suffix=")" suffixOverrides=",">
      <if test="id != null">`id`,</if>
      <if test="followerId != null">`follower_id`,</if>
      <if test="followerNickname != null">`follower_nick_name`,</if>
      <if test="followerSelfSignature != null">`follower_self_signature`</if>
      <if test="followerAvatarUrl != null">`follower_avatar_url`</if>
      <if test="userId != null">`user_id`,</if>
      <if test="userNickname != null">`user_nick_name`,</if>
      <if test="userSelfSignature != null">`user_self_signature`</if>
      <if test="userAvatarUrl != null">`user_avatar_url`</if>
    </trim>

    <trim prefix="VALUES(" suffix=")" suffixOverrides=",">
      <if test="id != null">#{id},</if>
      <if test="followerId != null">#{followerId},</if>
      <if test="followerNickname != null">#{followerNickname},</if>
      <if test="followerSelfSignature != null">#{followerSelfSignature}</if>
      <if test="userId != null">#{userId},</if>
      <if test="userNickname != null">#{userNickname},</if>
      <if test="userSelfSignature != null">#{userSelfSignature}</if>
      <if test="userAvatarUrl != null">#{userAvatarUrl}</if>
    </trim>
  </insert>
  <delete id="deleteRelation">
    DELETE FROM `user_relation` WHERE `user_id`=#{userId} AND `follower_id`=#{followerId}
  </delete>
  <select id="findFollowerByUserId" resultType="userRelationEntity" resultMap="userRelation">
    SELECT <include refid="columns"/> FROM `user_relation` WHERE `user_id`=#{userId}
  </select>
  <select id="findUserByFollowerId" resultType="userRelationEntity" resultMap="userRelation">
    SELECT <include refid="columns"/> FROM `user_relation` WHERE `follower_id`=#{followerId}
  </select>
    <select id="isExists" resultType="java.lang.Boolean">
      SELECT COUNT(id) FROM `user_relation` WHERE `user_id`=#{userId} AND `follower_id`=#{followerId}
    </select>


</mapper>

